
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{dataCleaning}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Global functions and variables\PYZdq{}\PYZdq{}\PYZdq{}}
        
        \PY{k+kn}{import} \PY{n+nn}{pymysql}
        
        \PY{k}{def} \PY{n+nf}{open\PYZus{}conn}\PY{p}{(}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}open the connection before each test case\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{n}{conn} \PY{o}{=} \PY{n}{pymysql}\PY{o}{.}\PY{n}{connect}\PY{p}{(}\PY{n}{user}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{public}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{password}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ece656yelp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                           \PY{n}{host}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{maindb.czbva1am4d4u.us\PYZhy{}east\PYZhy{}2.rds.amazonaws.com}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                           \PY{n}{database}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{yelp\PYZus{}db}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{k}{return} \PY{n}{conn}
        
        \PY{k}{def} \PY{n+nf}{close\PYZus{}conn}\PY{p}{(}\PY{n}{conn}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}close the connection after each test case\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{n}{conn}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
        
        \PY{k}{def} \PY{n+nf}{executeQuery}\PY{p}{(}\PY{n}{conn}\PY{p}{,} \PY{n}{query}\PY{p}{,} \PY{n}{commit}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} fetch result after query\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{n}{cursor} \PY{o}{=} \PY{n}{conn}\PY{o}{.}\PY{n}{cursor}\PY{p}{(}\PY{p}{)}
            \PY{n}{query\PYZus{}num} \PY{o}{=} \PY{n}{query}\PY{o}{.}\PY{n}{count}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{;}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
            \PY{k}{if} \PY{n}{query\PYZus{}num} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
                \PY{k}{for} \PY{n}{result} \PY{o+ow}{in} \PY{n}{cursor}\PY{o}{.}\PY{n}{execute}\PY{p}{(}\PY{n}{query}\PY{p}{,} \PY{n}{params}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{multi}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{p}{:}
                    \PY{k}{if} \PY{n}{result}\PY{o}{.}\PY{n}{with\PYZus{}rows}\PY{p}{:}
                        \PY{n}{result} \PY{o}{=} \PY{n}{result}\PY{o}{.}\PY{n}{fetchall}\PY{p}{(}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{cursor}\PY{o}{.}\PY{n}{execute}\PY{p}{(}\PY{n}{query}\PY{p}{)}
                \PY{n}{result} \PY{o}{=} \PY{n}{cursor}\PY{o}{.}\PY{n}{fetchall}\PY{p}{(}\PY{p}{)}
            \PY{c+c1}{\PYZsh{} we commit the results only if we want the updates to Can\PYZsq{}t leave a review dated before account creationthe database}
            \PY{c+c1}{\PYZsh{} to persist.}
            \PY{k}{if} \PY{n}{commit}\PY{p}{:}
                \PY{n}{conn}\PY{o}{.}\PY{n}{commit}\PY{p}{(}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{conn}\PY{o}{.}\PY{n}{rollback}\PY{p}{(}\PY{p}{)}
            \PY{c+c1}{\PYZsh{} close the cursor used to execute the query}
            \PY{n}{cursor}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
            \PY{k}{return} \PY{n}{result}
        
        \PY{n}{yelp\PYZus{}conn} \PY{o}{=} \PY{n}{open\PYZus{}conn}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \subsection{Part I. Data cleaning}\label{part-i.-data-cleaning}

    \paragraph{1. Check that no review is from the future or before Yelp's
founding}\label{check-that-no-review-is-from-the-future-or-before-yelps-founding}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{n}{query\PYZus{}1} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SELECT id, date FROM review WHERE unix\PYZus{}timestamp(date) \PYZlt{}= unix\PYZus{}timestamp(}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{2004\PYZhy{}10\PYZhy{}01}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{)}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           OR unix\PYZus{}timestamp(date) \PYZgt{}= unix\PYZus{}timestamp(}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{2018\PYZhy{}01\PYZhy{}01}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{;}
         
         \PY{n}{result\PYZus{}1} \PY{o}{=} \PY{n}{executeQuery}\PY{p}{(}\PY{n}{yelp\PYZus{}conn}\PY{p}{,} \PY{n}{query\PYZus{}1}\PY{p}{)}
         \PY{n}{result\PYZus{}1}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}13}]:} (('03B9-gqbeGoMmPJbNzNT5w', datetime.datetime(2004, 9, 15, 0, 0)), ('PbIY2aIyszb6he6J-ey67w', datetime.datetime(2004, 7, 22, 0, 0)))
\end{Verbatim}
            
    This shows 2 accounts that were created before Yelp's founding in
October 2004.

    \paragraph{2. Can't leave a review dated before account
creation}\label{cant-leave-a-review-dated-before-account-creation}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{n}{query\PYZus{}2} \PY{o}{=}  \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SELECT user.id, user.yelping\PYZus{}since AS Date\PYZus{}started\PYZus{}yelping, review.date AS Date\PYZus{}of\PYZus{}Review}\PY{l+s+se}{\PYZbs{}}
        \PY{l+s+s2}{            FROM (user INNER JOIN review ON user.id = review.user\PYZus{}id)}\PY{l+s+se}{\PYZbs{}}
        \PY{l+s+s2}{            WHERE user.yelping\PYZus{}since \PYZgt{} review.date}\PY{l+s+se}{\PYZbs{}}
        \PY{l+s+s2}{            GROUP BY user.id;}\PY{l+s+s2}{\PYZdq{}}
        
        \PY{n}{result\PYZus{}2} \PY{o}{=} \PY{n}{executeQuery}\PY{p}{(}\PY{n}{yelp\PYZus{}conn}\PY{p}{,} \PY{n}{query\PYZus{}2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{n+nb}{len}\PY{p}{(}\PY{n}{result\PYZus{}2}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}3}]:} 191
\end{Verbatim}
            
    This means these users somehow posted a review before their account was
created, suggesting a glitch with their database.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{n}{output} \PY{o}{=} \PY{p}{[}\PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)} \PY{k}{for} \PY{n}{result} \PY{o+ow}{in} \PY{n}{result\PYZus{}2}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{20}\PY{p}{]}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
('-58CWJ48is4duXgpvsWEGA', datetime.datetime(2013, 9, 18, 0, 0), datetime.datetime(2008, 10, 23, 0, 0))
('-9NfX8JO\_5UVN\_h1K8yOcg', datetime.datetime(2015, 2, 12, 0, 0), datetime.datetime(2010, 2, 26, 0, 0))
('-kEsfYKPs1\_rgEWEIui2Mw', datetime.datetime(2015, 2, 14, 0, 0), datetime.datetime(2014, 4, 7, 0, 0))
('-KP8Me2KRqO7IwKIaFL-Vg', datetime.datetime(2013, 10, 19, 0, 0), datetime.datetime(2013, 9, 2, 0, 0))
('09T8OU8BDhQkiU8m4vZy\_A', datetime.datetime(2013, 10, 21, 0, 0), datetime.datetime(2013, 10, 16, 0, 0))
('0xjJDvZ6gZVoWRFEZJ48wA', datetime.datetime(2007, 1, 17, 0, 0), datetime.datetime(2007, 1, 15, 0, 0))
('1F9di6oPHhQm1qjZIcbsYA', datetime.datetime(2013, 12, 5, 0, 0), datetime.datetime(2013, 10, 5, 0, 0))
('2Ea6wAkeOPyZ7BD-0rPejQ', datetime.datetime(2013, 9, 18, 0, 0), datetime.datetime(2012, 10, 9, 0, 0))
('2oxUNDpouxH8Y02yG6pG-w', datetime.datetime(2010, 4, 28, 0, 0), datetime.datetime(2006, 1, 25, 0, 0))
('37jJedy6\_ptCmNvBJ-H54g', datetime.datetime(2014, 8, 16, 0, 0), datetime.datetime(2007, 3, 10, 0, 0))
('3BHeHTGNZcaEi8woqGy2kA', datetime.datetime(2013, 10, 19, 0, 0), datetime.datetime(2013, 10, 4, 0, 0))
('3cKcTbCIWp97pK8lo0Ao5Q', datetime.datetime(2015, 2, 12, 0, 0), datetime.datetime(2012, 11, 4, 0, 0))
('3M1IB2QtJOuBlneiZ1532w', datetime.datetime(2013, 10, 22, 0, 0), datetime.datetime(2013, 10, 4, 0, 0))
('3wCR1kGccoxgfuzzQ0\_p-A', datetime.datetime(2013, 10, 18, 0, 0), datetime.datetime(2012, 1, 21, 0, 0))
('4jIlAyittJukBRteYp2Gig', datetime.datetime(2014, 1, 28, 0, 0), datetime.datetime(2011, 12, 20, 0, 0))
('5eLIdrtZFjQO1VCWwWok2w', datetime.datetime(2013, 8, 18, 0, 0), datetime.datetime(2012, 8, 13, 0, 0))
('5o3iqx2ueZmiTIRVuuO4nw', datetime.datetime(2013, 5, 26, 0, 0), datetime.datetime(2012, 12, 24, 0, 0))
('6ESU4WqmScR1Vpjr1nDDig', datetime.datetime(2013, 10, 17, 0, 0), datetime.datetime(2013, 10, 14, 0, 0))
('6i8vhqI1x9qzJ4fjT\_x6xQ', datetime.datetime(2008, 3, 24, 0, 0), datetime.datetime(2007, 3, 19, 0, 0))
('6LDypE52IBrhXeYsd-6uqw', datetime.datetime(2015, 2, 14, 0, 0), datetime.datetime(2014, 1, 10, 0, 0))

    \end{Verbatim}

    \paragraph{3. Can't be elite in a year before their account was
made}\label{cant-be-elite-in-a-year-before-their-account-was-made}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}26}]:} \PY{n}{query\PYZus{}3} \PY{o}{=}  \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SELECT user.id, user.yelping\PYZus{}since AS Date\PYZus{}of\PYZus{}yelping, elite\PYZus{}years.year AS Year\PYZus{}of\PYZus{}Elite}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{            FROM (user INNER JOIN elite\PYZus{}years ON user.id = elite\PYZus{}years.user\PYZus{}id)}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{            WHERE YEAR(user.yelping\PYZus{}since) \PYZlt{} elite\PYZus{}years.year}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{            GROUP BY user.id;}\PY{l+s+s2}{\PYZdq{}}
         
         \PY{n}{result\PYZus{}3} \PY{o}{=} \PY{n}{executeQuery}\PY{p}{(}\PY{n}{yelp\PYZus{}conn}\PY{p}{,} \PY{n}{query\PYZus{}3}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}27}]:} \PY{n+nb}{len}\PY{p}{(}\PY{n}{result\PYZus{}3}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}27}]:} 55493
\end{Verbatim}
            
    \paragraph{4. Can't checkin outside open
hours}\label{cant-checkin-outside-open-hours}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}33}]:} \PY{n}{query\PYZus{}4} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SELECT COUNT(*) FROM checkin JOIN (SELECT hours.business\PYZus{}id, SUBSTRING\PYZus{}INDEX(hours, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{|}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, 1)}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           AS day\PYZus{}of\PYZus{}week, SUBSTRING\PYZus{}INDEX(SUBSTRING\PYZus{}INDEX(hours, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{|}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, \PYZhy{} 1), }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, 1) AS opening\PYZus{}time,}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           SUBSTRING\PYZus{}INDEX(SUBSTRING\PYZus{}INDEX(hours, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{|}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, \PYZhy{} 1), }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, \PYZhy{} 1) AS closing\PYZus{}time FROM hours)}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           AS a ON a.business\PYZus{}id = checkin.business\PYZus{}id}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           AND a.day\PYZus{}of\PYZus{}week = SUBSTRING\PYZus{}INDEX(checkin.date, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, 1)}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           WHERE a.opening\PYZus{}time \PYZgt{} SUBSTRING\PYZus{}INDEX(checkin.date, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, \PYZhy{} 1)}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           AND a.closing\PYZus{}time \PYZlt{} SUBSTRING\PYZus{}INDEX(checkin.date, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, \PYZhy{} 1);}\PY{l+s+s2}{\PYZdq{}}
         \PY{n}{result\PYZus{}4} \PY{o}{=} \PY{n}{executeQuery}\PY{p}{(}\PY{n}{yelp\PYZus{}conn}\PY{p}{,} \PY{n}{query\PYZus{}4}\PY{p}{)}
         \PY{n}{result\PYZus{}4}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}33}]:} ((480488,),)
\end{Verbatim}
            
    This shows that there are many check ins that occur outside of the
businesses open hours which are potentially invalid checkins, but this
is not a guarantee because it is possible that the business changed
their hours of operation at some point after someone checked in,
resulting in the discrepency.

This also shows the need within the database for the date column in the
checkin and the hours column in the hours table to be normalized by
splitting into date, opening time and closing time columns as this would
save computation time having to perform substring\_index computations on
every row.

    \paragraph{\texorpdfstring{5. \texttt{User.review\_count} cannot be less
than the sum of the number of reviews by a
user}{5. User.review\_count cannot be less than the sum of the number of reviews by a user}}\label{user.reviewux5fcount-cannot-be-less-than-the-sum-of-the-number-of-reviews-by-a-user}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{n}{query\PYZus{}5} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{select count(*) from user join (select count(user\PYZus{}id) as countedReviews, user\PYZus{}id from}\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{           review group by user\PYZus{}id) as a on a.user\PYZus{}id = user.id where a.countedReviews \PYZgt{} review\PYZus{}count;}\PY{l+s+s2}{\PYZdq{}}
         \PY{n}{result\PYZus{}5} \PY{o}{=} \PY{n}{executeQuery}\PY{p}{(}\PY{n}{yelp\PYZus{}conn}\PY{p}{,} \PY{n}{query\PYZus{}5}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{result\PYZus{}5}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(1319,)

    \end{Verbatim}

    This shows that the way Yelp gets the review\_count number is
potentially flawed since it should never count there being less reviews
than the number of reviews provided for each user, unless the dataset
that it was acquiring the count from was out of date.

    \paragraph{6. Cannot be Elite in an invalid
year}\label{cannot-be-elite-in-an-invalid-year}

Invalid years include ones before 2004, years in the future or years
they didn't post a review, tip or photo.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{n}{query\PYZus{}6} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{select count(*) from elite\PYZus{}years join }\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{(SELECT user\PYZus{}id, SUBSTRING\PYZus{}INDEX(date, }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, 1) AS year FROM review) }\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{as a on a.user\PYZus{}id=elite\PYZus{}years.user\PYZus{}id and a.year = elite\PYZus{}years.year }\PY{l+s+se}{\PYZbs{}}
         \PY{l+s+s2}{group by elite\PYZus{}years.user\PYZus{}id, elite\PYZus{}years.year;}\PY{l+s+s2}{\PYZdq{}}
         \PY{n}{result\PYZus{}6} \PY{o}{=} \PY{n}{executeQuery}\PY{p}{(}\PY{n}{yelp\PYZus{}conn}\PY{p}{,} \PY{n}{query\PYZus{}6}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{result\PYZus{}6}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(37,)

    \end{Verbatim}

    In total there are 186900 entries in elite\_years. 37 appear to be
erroneous.

    \subsection{Part 2. Data Indexing}\label{part-2.-data-indexing}

To allow for faster queries additional indices were added to some tables
in the database. This includes: * adding one to the year column in the
table elite\_years to speed up query\_6 * create index idx\_year on
elite\_years(year) * adding one to the yelping\_since column in the user
table * create index idx\_yelping\_since on user(yelping\_since) *
creating new columns in the hours table to split the hours column into
date, opening\_time and closing\_time and creating an index for each of
these * create index idx\_day\_of\_week on hours(day\_of\_week) *
creating new columns in the checkin table to split the date column into
date\_of\_week and time and creating an index for each of these * create
index idx\_day\_of\_week on hours(day\_of\_week) * creating new columns
in the review table to split the date column into year, month, day
columns and scrapping the time because its always 00:00:00 * select
count(*) from review where substring\_index(date, ' ', -1) !=
'00:00:00'; \#returns 0


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
